<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en-us lang=en-us><head><link href=https://gmpg.org/xfn/11 rel=profile><meta charset=utf-8><meta name=generator content="Hugo 0.83.0"><meta name=viewport content="width=device-width,initial-scale=1"><title>Kwantizer &#183; benjiaomodular</title><meta name=description content="An Arduino-based CV quantizer. Input and output at 0 to +5V range."><meta property="og:title" content="Kwantizer"><meta property="og:description" content="An Arduino-based CV quantizer. Input and output at 0 to +5V range."><meta property="og:type" content="website"><meta property="og:image" content="https://benjiaomodular.com/post/2022-01-17-kwantizer/kwantizer.thumb.jpg"><meta property="og:url" content="https://benjiaomodular.com/post/2022-01-17-kwantizer/"><link type=text/css rel=stylesheet href=https://benjiaomodular.com/css/print.css media=print><link type=text/css rel=stylesheet href=https://benjiaomodular.com/css/poole.css><link type=text/css rel=stylesheet href=https://benjiaomodular.com/css/syntax.css><link type=text/css rel=stylesheet href=https://benjiaomodular.com/css/hyde.css><link type=text/css rel=stylesheet href=https://benjiaomodular.com/css/main.css><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,wght@0,400;0,500;0,700;1,400&display=swap" rel=stylesheet><link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,wght@0,400;0,500;0,700;1,400&family=Exo+2:wght@700&display=swap" rel=stylesheet><link rel=apple-touch-icon-precomposed sizes=144x144 href=/images/favicon/apple-touch-icon.png><link rel="shortcut icon" href=/images/favicon/favicon.ico><link rel="shortcut icon" type=image/png href=/images/favicon/icon-192x192.png><link rel="shortcut icon" sizes=192x192 href=/images/favicon/icon-192x192.png></head><body><aside class=sidebar><div class="container sidebar-sticky"><div class=sidebar-about><a href=https://benjiaomodular.com/><h1>benjiaomodular</h1></a><p class=lead>My personal Synth DIY notes.</p></div><nav><ul class=sidebar-nav><li><a href=https://benjiaomodular.com/>Modules</a></li><li><a href=https://benjiaomodular.com/about/>About</a></li></ul></nav><ul class=socials-nav><li><a href=https://youtube.com/BenjieJiao target=_blank><img class=socials-nav-img title=Youtube src=/images/icon-yt.png width=30rem height=30rem></a></li><li><a href=https://github.com/benjiaomodular target=_blank><img class=socials-nav-img title=Github src=/images/icon-gh.png width=30rem height=30rem></a></li><li><a href=https://instagram.com/benjiaomodular target=_blank><img class=socials-nav-img title=Instagram src=/images/icon-ig.png width=30rem height=30rem></a></li><li><a href=https://facebook.com/benjiaomodular target=_blank><img class=socials-nav-img title=Facebook src=/images/icon-fb.png width=30rem height=30rem></a></li></ul><div class=ko-fi-button><script type=text/javascript src=https://storage.ko-fi.com/cdn/widget/Widget_2.js></script><script type=text/javascript>kofiwidget2.init('Support Me on Ko-fi','#000000','C0C24WFYS'),kofiwidget2.draw()</script></div><p class=sidebar-copyright>&copy; 2022. All rights reserved.</p></div></aside><main class="content container"><div class="single post"><h1 class=title>Kwantizer</h1><time datetime=2022-01-17T00:00:00Z class=post-date>Mon, Jan 17, 2022</time><div class=tag-section><a class=post-tag href=https://benjiaomodular.com/tags/+/-12v/>+/-12v</a>
<a class=post-tag href=https://benjiaomodular.com/tags/+9v/>+9v</a>
<a class=post-tag href=https://benjiaomodular.com/tags/arduino/>arduino</a></div><p>Lately, my setup hasn&rsquo;t trully been all-DIY *gasp*. I&rsquo;ve been dependent on my Korg SQ-1 and Beatsteap Pro for sequencing. They let me pick a key and the notes just magically fall into place.</p><figure class=article-figure><a href=https://benjiaomodular.com/post/2022-01-17-kwantizer/kwantizer-with-baby8.jpg><img class=article-image src=https://benjiaomodular.com/post/2022-01-17-kwantizer/kwantizer-with-baby8.jpg></a><div class=figure-caption>The perfboard prototype of the Kwantizer beside my old Baby-8 sequencer.</div></figure><p>I did build a <a href=/post/2021-04-09-8-step-sequencer/>fully analog Baby-8 sequencer</a> last year but the nondiscrete voltage output meant I had to tune each step to make it sound musical.</p><p>I decided to fix that and build a quantizer. It takes a voltage and tunes it to the nearest note in a scale. <em>It&rsquo;s autotune for control voltages</em>.</p><figure class=article-figure><a href=https://benjiaomodular.com/post/2022-01-17-kwantizer/scope-maj7.png><img class=article-image src=https://benjiaomodular.com/post/2022-01-17-kwantizer/scope-maj7.png></a><div class=figure-caption>Control voltage from my Baby-8 sequencer (yellow) and the output from Kwantizer (blue). The output is quantized to the notes of Cmaj7.</div></figure><p>Here&rsquo;s a video of it in action:<div style=position:relative;padding-bottom:56.25%;overflow:hidden;display:block><iframe src="https://www.youtube.com/embed/gzfh_n8PrDI?start=" style=position:absolute;top:0;left:0;width:100%;height:100%;border:0 allowfullscreen frameborder=0 title="YouTube Video"></iframe></div><p></p></p><h1 id=input-and-output>Input and output</h1><p>This module can handle CV from 0 to +5V, both for input and output. The range allows for 5 octaves in total.</p><p>I still have to decide on a better overvoltage protection solution, though. I added some BAT41 clamping diodes, but it seems to only do its thing at around 6.2V so be careful. Arduinos have a 5.5V limit on their input pins.</p><figure class=article-figure><a href=https://benjiaomodular.com/post/2022-01-17-kwantizer/kwantizer-clamp.png><img class=article-image src=https://benjiaomodular.com/post/2022-01-17-kwantizer/kwantizer-clamp.png></a></figure><p>I&rsquo;ll check out some other options for this. Maybe later I&rsquo;ll talk about it in a separate post.</p><h1 id=scale-selection>Scale selection</h1><p>I used <a href=https://github.com/alicedb2/tinyQuan>Alice Beaupré&rsquo;s tinyQuan circuit on Github</a> as a starting point. Her version has an awesome library of scales along with a screen. I used neither.</p><p>For my design I decided to go with a key layout inspired by <a href=https://library.vcvrack.com/HolonicSystems-Free/HolonicSystems-LazySusanQuantiser>Holonic Systems' Lazy Susan Quantizer</a>&ndash;a plugin I frequently use on VCV Rack. I like how you can set your own scales using a keyboard layout.</p><p>I find it nice that I can add or remove notes on the fly.</p><figure class=article-figure><a href=https://benjiaomodular.com/post/2022-01-17-kwantizer/lazysusan.png><img class=article-image src=https://benjiaomodular.com/post/2022-01-17-kwantizer/lazysusan.png></a></figure><p>I decided to do it using DIP switches. In hindsight, after playing with it a bit, the tiny switches make it a bit fiddly. It&rsquo;s not bad if you want a really small layout though.</p><figure class=article-figure><a href=https://benjiaomodular.com/post/2022-01-17-kwantizer/kwantizer-switches.jpg><img class=article-image src=https://benjiaomodular.com/post/2022-01-17-kwantizer/kwantizer-switches.jpg></a><div class=figure-caption>It's ugly but it's mine. The DIP switches for selecting active notes.</div></figure><p>Yes, I used hot glue to mount them. I&rsquo;m sorry.</p><h1 id=tuning>Tuning</h1><p>My build so far has not been tuned properly because I was waiting for my L317 voltage regulators to arrive.</p><figure class=article-figure><a href=https://benjiaomodular.com/post/2022-01-17-kwantizer/kwantizer-tune.jpg><img class=article-image src=https://benjiaomodular.com/post/2022-01-17-kwantizer/kwantizer-tune.jpg></a><div class=figure-caption>A DIP switch for activating tuning mode</div></figure><p>In the schematics, I added a &ldquo;tune&rdquo; switch that sets the DAC to put out 5V and a trim pot to adjust the output of the LM317 regulator. The idea is to tune the regulator until the output of the DAC is as close to 5V as possible. But I still have to verify how well this setup lets me hit the mark.</p><p>In the meantime, I used a 78L05 regulator to give me a somewhat stable 5V source.</p><p>I&rsquo;ll probably post some updates on <a href=https://instagram.com/benjiaomodular>Instagram</a> once I get it to work.</p><h1 id=components>Components</h1><h2 id=bill-of-materials>Bill of materials</h2><ul><li>1 x Arduino Nano</li><li>1 x 100pF capacitor</li><li>2 x BAT41</li><li>2 x 3.5mm audio jack</li><li>17 x 10k resistors</li><li>1 x 10k multi-turn trimmer potentiometer</li><li>1 x 7 position DIP switch</li><li>1 x 3 position DIP switch</li><li>1 x 2 position DIP switch</li><li>1 x 1 position DIP switch</li><li>1 x LM317</li><li>1 x ADS1115</li><li>1 x MCP4725</li></ul><h3 id=the-analog-to-digital-converter>The Analog to Digital Converter</h3><p>I bought the ADC off of <a href=https://www.makerlab-electronics.com/>Makerlab Electronics</a>, an online electronics shop here in the Philippines. <a href="https://www.lazada.com.ph/products/i110080259-s111830692.html?urlFlag=true&mp=1">Here&rsquo;s a link</a> to the actual item.</p><p>I chose to buy something like this in breakout board form so I could avoid soldering SMD. It worked just fine though, I just used the markings on the board as reference.</p><p><figure class=article-figure><a href=https://benjiaomodular.com/post/2022-01-17-kwantizer/kwantizer-adc1.jpg><img class=article-image src=https://benjiaomodular.com/post/2022-01-17-kwantizer/kwantizer-adc1.jpg></a><div class=figure-caption>The front of the ADC.</div></figure><figure class=article-figure><a href=https://benjiaomodular.com/post/2022-01-17-kwantizer/kwantizer-adc3.jpg><img class=article-image src=https://benjiaomodular.com/post/2022-01-17-kwantizer/kwantizer-adc3.jpg></a><div class=figure-caption>The back of the ADC.</div></figure></p><h3 id=the-digital-to-analog-converter>The Digital to Analog Converter</h3><p>The DAC I used is also a breakout board. I got it from <a href=https://circuit.rocks/>circuit.rocks</a>, another online electronics shop here in the Philippines I frequently buy from. <a href=https://www.lazada.com.ph/products/i111660952-s113849411.html>Here&rsquo;s a link</a> to the item.</p><p><figure class=article-figure><a href=https://benjiaomodular.com/post/2022-01-17-kwantizer/kwantizer-dac1.jpg><img class=article-image src=https://benjiaomodular.com/post/2022-01-17-kwantizer/kwantizer-dac1.jpg></a><div class=figure-caption>The front of the DAC.</div></figure><figure class=article-figure><a href=https://benjiaomodular.com/post/2022-01-17-kwantizer/kwantizer-dac2.jpg><img class=article-image src=https://benjiaomodular.com/post/2022-01-17-kwantizer/kwantizer-dac2.jpg></a><div class=figure-caption>The back of the DAC.</div></figure></p><h1 id=schematics>Schematics</h1><p>Here&rsquo;s my schematics based on <a href=https://github.com/alicedb2/tinyQuan>Alice Beaupré&rsquo;s tinyQuan circuit</a>. I added the overvoltage protection section at the input, which I still intend on improving.</p><figure class=article-figure><a href=https://benjiaomodular.com/post/2022-01-17-kwantizer/Kwantizer.png><img class=article-image src=https://benjiaomodular.com/post/2022-01-17-kwantizer/Kwantizer.png></a></figure><h1 id=arduino-code>Arduino Code</h1><p>My code for this is a stripped down version of Alice&rsquo;s. Without the screen and the scales library, it&rsquo;s pretty lean. I could probably use it as reference for future Arduino projects.</p><p>The latest code is <a href=https://github.com/benjiaomodular/Kwantizer/tree/main/Arduino/Kwantizer>on my Github</a>.</p><p>Some important libraries you&rsquo;ll need to install:</p><ul><li>MCP4725 by Rob Tillaart</li><li>ADS1X15 by Rob Tillaart</li></ul><p>It comes in two files: (1) <strong>Kwantizer.ino</strong> contains the main source code and (2) <strong>definitions.h</strong> contains some contant variables and look-up tables.</p><h1 id=conclusion>Conclusion</h1><p>My perfboard prototype for this has to be my ugliest looking build yet. It works well though. I should build a PCB for this in the future so I can do it justice.</p><figure class=article-figure><a href=https://benjiaomodular.com/post/2022-01-17-kwantizer/kwantizer-on-table.jpg><img class=article-image src=https://benjiaomodular.com/post/2022-01-17-kwantizer/kwantizer-on-table.jpg></a></figure><p>Let me know if you&rsquo;ve built it! Tag me on Instagram <a href=https://instagram.com/benjiaomodular>@benjiaomodular</a>.</p></div></main><script async src="https://www.googletagmanager.com/gtag/js?id=G-P9PT1HTQR7"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-P9PT1HTQR7',{anonymize_ip:!1})}</script></body></html>